FROM openjdk:11.0.3-jre-stretch

ARG ENV=default
ARG DB_IP
ARG DB_PORT
ARG DATASOURCE_URL
ARG DATABASE
ARG DB_USERNAME
ARG DB_PASSWORD


ENV DATABASE_IP $DB_IP
ENV DATABASE_PORT $DB_PORT
ENV SPRING_PROFILES_ACTIVE $ENV
ENV SPRING_JPA_DATABASE $DATABASE
ENV SPRING_DATASOURCE_URL $DATASOURCE_URL
ENV SPRING_DATASOURCE_USERNAME $DB_USERNAME
ENV SPRING_DATASOURCE_PASSWORD $DB_PASSWORD

COPY target/demo-backend.jar /home/demo-backend.jar
COPY wait-for-it.sh /home
EXPOSE 8080

CMD ["/home/wait-for-it.sh", "$DATABASE_IP:$DATABASE_PORT", "--", "java", "-jar", "/home/demo-backend.jar"]