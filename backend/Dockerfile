FROM openjdk:11.0.3-jre-stretch

ARG ENV=default
ARG DB_IP
ARG DB_PORT
ARG DB_NAME
ARG DATABASE_TYPE
ARG DB_USERNAME
ARG DB_PASSWORD


ENV DATABASE_IP $DB_IP
ENV DATABASE_PORT $DB_PORT
ENV SPRING_PROFILES_ACTIVE $ENV
ENV SPRING_JPA_DATABASE ${DATABASE_TYPE}
ENV SPRING_DATASOURCE_URL "jdbc:${DATABASE_TYPE}://${DB_IP}:${DB_PORT}/${DB_NAME}"
ENV SPRING_DATASOURCE_USERNAME $DB_USERNAME
ENV SPRING_DATASOURCE_PASSWORD $DB_PASSWORD
ENV KEYCLOAK_PUBLICKEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwPyWsOmXJ/AS6VkFChEF61l2TWPr5nbr++JZIiGcpRFhs69ueI8Pxuvp+1O7qH8v9Nqvaol8gTdXeNl5yLRBlUI5hKwxV9E7vIFUDvNwhWmu9Vmzw+SFM+l6Yci9J0ucRcyC776M0v7PLaKV6svE8aeweYus26U7Wc0Cqhq1i2S+E8nObXbCn1hdn9rnp587rJsXngoMk0ffGhbdgYIdRpUFz/RAjYv9g8krpBAwz46IqNGTSPmXCtV53eHRPr/pTHAxxNPHt2es/C2DmW41GUX4HNVlxLVquB4sEkyIq1PI3Kn1yrnFVqFF/qLZFXdKwyLP3xb6cQEUvjXADQB/3wIDAQAB

COPY target/demo-backend.jar /home/demo-backend.jar
COPY wait-for-it.sh /home
EXPOSE 8080

CMD ["/home/wait-for-it.sh", "$DATABASE_IP:$DATABASE_PORT","-t","5","--", "java", "-jar", "/home/demo-backend.jar"]